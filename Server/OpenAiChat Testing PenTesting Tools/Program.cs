using System;
using System.Net;
using System.Net.Sockets;

namespace C2Server
{
    class Program
    {
        static void Main(string[] args)
        {
            // Set up the server
            int port = 8000;
            IPAddress ip = IPAddress.Parse("127.0.0.1");
            TcpListener server = new TcpListener(ip, port);

            // Start listening for incoming connections
            server.Start();
            Console.WriteLine("Server started. Waiting for connections...");

            // Accept incoming connections
            TcpClient client = server.AcceptTcpClient();
            Console.WriteLine("Client connected.");

            // Get the client's stream
            NetworkStream stream = client.GetStream();

            // Read incoming data
            byte[] buffer = new byte[1024];
            int bytesRead = stream.Read(buffer, 0, 1024);
            string data = System.Text.Encoding.ASCII.GetString(buffer, 0, bytesRead);

            // Process the incoming data
            Console.WriteLine("Received data: " + data);

            while (true)
            {
                // Send a response
                string response = Console.ReadLine();
                byte[] responseBytes = System.Text.Encoding.ASCII.GetBytes(response);
                stream.Write(responseBytes, 0, responseBytes.Length);
            }

            // Close the client's connection
            client.Close();
        }
    }
}